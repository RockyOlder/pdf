function MonthlyRecommendation(){var e=parseInt($("#pdt_id_number").val());if(1==e){$(".original").show();var n=$('.item[name="tc_default"]').data("now"),t=$('.item[name="tc_default"]').data("first");$("#pay .save_money").html("省"+(t-n)+"元"),$("#pay .pay_money").html(n+"元"),$(".last_pay .pay_money").html(n),$("#pay .first_price").html("原价"+t+"元");var i=$("#actState").val();0==i?$(".discount").html(""):1==i&&$(".discount").html('<div class="left">优惠折扣:</div><div class="right">赠送5次转换</div>')}}define(["tool"],function(e){return payment={_this_number_Permission_PaymentSerialCount:document.getElementById("PaymentSerialCount").value,_this_number_value:3,init:function(){this.PayTreasure(),this.doCancel("content_payment"),this._this_number_Permission_PaymentSerialCount>this._this_number_value?(this.parymentZfbComfim(),this.parymentWXComfim()):(this.generateOrder(),this.WenxinPay())},PayTreasure:function(){$(".pay_zfb").click(function(){var e="/Ucenter/Financial/doALIPAY?code=ALIPAY&o_id="+$("#o_id").val()+"&details="+parseInt($("#details").val());window.open(e),$("#be_paid").hide(),$("#pay_Waiting").css("display","inline-block").siblings().hide(),payment.onloadQueryApplayOrderPAy()})},onloadQueryApplayOrderPAy:function(){$.ajax({url:"/Ucenter/Orders/getApplayOid/?order_no="+$("#o_id").val()+"&t="+Math.round(1e6*Math.random()),type:"GET",dataType:"json",success:function(n){1==n.action?($("#pay_Waiting").hide(),$("#play_success").show(),$("#play_success").css("display","inline-block").siblings().hide(),$("#pay_sccess_price").html(n.order.o_all_price),$("#total_number").html(n.order.number_remaining),$("#total_time").html(n.order.end_time),e.ajaxLoadShoppingHeader(),clearTimeout(payment.onloadQueryApplayOrderPAy)):$("#pay_Waiting").is(":hidden")?clearTimeout(payment.onloadQueryApplayOrderPAy):setTimeout(function(){payment.onloadQueryApplayOrderPAy()},3e3)}})},sendWXorder:function(){var e=$("#pdt_id").val(),n=parseInt($("#details").val()),t=parseInt($("#pdt_stock").val()),i=$("#pdt_sn").val(),a=$("#pdt_sale_price").val();if($("#pc_abbreviation").val("WEIXIN"),isNaN(n))return void $.ThinkBox.error("异常错误");if(""==i)return void $.ThinkBox.error("SKU编码不能为空");if(isNaN(a))return void $.ThinkBox.error("价格不能为空");if(""==e)return void $.ThinkBox.error("异常错误:pdt为空");if(t<1)return void $.ThinkBox.error("数量不能小于一");var o=($("#submitSkipFrom").serialize(),"/Ucenter/Financial/doAddDepositOnline");$.ajax({url:o,dataType:"html",type:"post",data:{details:n,pdt_stock:t,pdt_id:e,pdt_sn:i,pdt_sale_price:a,pc_abbreviation:"WEIXIN"},success:function(e){var n=$("#PaymentSerialCount").val();1!==n&&($(".popup_content").html(e),$(".popup_weixin").show(),$(".popup_weixin .content").show(),$(".popup_weixin .content").css({"margin-top":($(window).height()-460)/2}),$(".popup_weixin .close").click(function(){$("#weixin_ifram").remove(),$(".popup_weixin").hide()}),payment.onloadQueryOrderPAy())}})},sendZfbOrder:function(){var e=$("#pdt_id").val(),n=parseInt($("#details").val()),t=parseInt($("#pdt_stock").val()),i=$("#pdt_sn").val(),a=$("#pdt_sale_price").val();return isNaN(n)?void $.ThinkBox.error("异常错误"):""==i?void $.ThinkBox.error("SKU编码不能为空"):isNaN(a)?void $.ThinkBox.error("价格不能为空"):""==e?void $.ThinkBox.error("异常错误:pdt为空"):t<1?void $.ThinkBox.error("数量不能小于一"):($("#pc_abbreviation").val("ALIPAY"),void $.ajax({url:"/Ucenter/Financial/ALIPAYPayOnline",dataType:"json",type:"post",data:{details:n,pdt_stock:t,pdt_id:e,pdt_sn:i,pdt_sale_price:a,pc_abbreviation:"ALIPAY"},success:function(e){var n=$("#PaymentSerialCount").val();1==e.action&&1!==n&&($(".popup_zfb").show(),$("#be_paid").css("display","inline-block").siblings().hide(),$(".popup_zfb #be_paid").css({"margin-top":($(window).height()-460)/2}),$("#o_id_orders").html(e.data.o_id),$("#o_id").val(e.data.o_id),$("#zfb_sale_price").html(e.data.pdt_sale_price),$("#pay_order_price").html(e.data.o_all_price),$("#preferential_price").html(e.data.pdt_sale_price-e.data.o_all_price))}}))},parymentWXComfim:function(){$(".weixin_pay").bind("click",function(e){1==$("#pdt_id_number").val()?2==$("#details").val()?payment.sendWXorder():(payment.SendConversionConfirm("content_payment"),$(".btn_recharge").attr("onclick","payment.WX_recharge()"),$(".btn_only_change").attr("onclick","payment.sendWXorder()"),$(".btn_only_change").one("click",function(){payment.doCancelHide("content_payment")})):payment.sendWXorder()})},SendConversionConfirm:function(e){$(".popup_other").show().siblings(".popup").hide(),$('.popup_other .content[name="'+e+'"]').css("display","inline-block"),$('.popup_other .content[name="'+e+'"]').css("margin-top",($(window).height()-$('.popup_other .content[name="'+e+'"]').height())/2)},doCancel:function(e){$(".popup .close").unbind("click").click(function(){$("#open_box").hide(),$(this).parent().hide(),$('.popup_other .content[name="'+e+'"]').hide()})},doCancelHide:function(e){var n=$(this);$("#open_box").hide(),n.parent().hide(),$('.popup_other .content[name="'+e+'"]').hide()},btn_recharge:function(){$("#pdt_id").val(2),$("#details").val(2),$("#pc_abbreviation").val("ALIPAY"),$("#pdt_sn").val("pdf_002"),$('.item[data-pdt_sn="pdf_001"]').removeClass("current"),$('.item[data-pdt_sn="pdf_002"]').addClass("current"),this.doCancelHide("content_payment"),this.sendZfbOrder(),MonthlyRecommendation()},WX_recharge:function(){$("#pdt_id").val(2),$("#details").val(2),$("#pc_abbreviation").val("WEIXIN"),$("#pdt_sn").val("pdf_002"),$('.item[data-pdt_sn="pdf_001"]').removeClass("current"),$('.item[data-pdt_sn="pdf_002"]').addClass("current"),this.doCancelHide("content_payment"),this.sendWXorder(),MonthlyRecommendation()},parymentZfbComfim:function(){$(".zfb_pay").bind("click",function(){1==$("#pdt_id_number").val()?2==$("#details").val()?payment.sendZfbOrder():(payment.SendConversionConfirm("content_payment"),$(".btn_recharge").attr("onclick","payment.btn_recharge()"),$(".btn_only_change").attr("onclick","payment.sendZfbOrder()"),$(".btn_only_change").one("click",function(){payment.doCancelHide("content_payment")})):payment.sendZfbOrder()})},generateOrder:function(){$(".zfb_pay").click(function(){payment.sendZfbOrder()})},WenxinPay:function(){$(".weixin_pay").click(function(){payment.sendWXorder()})},onloadQueryOrderPAy:function(){$.ajax({url:"/Ucenter/Orders/getOrderPyOid/?order_no="+$("#order_no").val()+"&t="+Math.round(1e6*Math.random()),type:"GET",dataType:"json",success:function(n){if(1==n.status){$("#weixin_ifram").remove(),$(".popup_weixin").hide(),clearTimeout(payment.onloadQueryOrderPAy);var t={title:"确定",btn:parseInt("0011",2),onOk:function(){window.location.href=n.url[0]}};e.ajaxLoadShoppingHeader(),window.wxc.xcConfirm("已支付成功，进入转换界面",window.wxc.xcConfirm.typeEnum.success,t),location.reload()}else $(".popup_weixin").is(":hidden")?clearTimeout(payment.onloadQueryOrderPAy):setTimeout(function(){payment.onloadQueryOrderPAy()},3e3)}})}}});