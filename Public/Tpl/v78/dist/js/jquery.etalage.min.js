!function(t){t.fn.etalage=function(a){var e=t.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,icon_offset:20,hide_cursor:!1,show_hint:!0,hint_offset:15,speed:600,autoplay:!0,autoplay_interval:6e3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},a);return t.each(this,function(){var a=t(this);if(a.is("ul")&&a.children("li").length&&a.find("img.etalage_source_image").length){var i,s,o,l,n,r,h,c,_,m,d=a.attr("id"),g=Math.floor(.7*e.speed),u=Math.round(e.speed/100),p=!1,f=!1,b=!1,v=!0,w=!1,y=0,I=0,k=0,C=0,T=0,z="hori";"undefined"!=typeof d&&d||(d="[no id]"),"left"!==e.smallthumbs_position&&"right"!==e.smallthumbs_position||(z="vert"),"object"==typeof t.browser&&t.browser.msie&&t.browser.version<9&&(v=!1,t.browser.version<7&&(b=!0)),a.addClass("etalage").show();var R=a.children("li").addClass("etalage_thumb");R.first().show().addClass("etalage_thumb_active");var q=R.length,L=e.autoplay;q<2&&(L=!1),"right"===e.align&&a.addClass("etalage_right"),t.each(R,function(a){a+=1;var e=t(this),i=e.find(".etalage_thumb_image").removeAttr("alt").show(),s=e.find(".etalage_source_image"),o=e.find("a");e.data("id",a).addClass("thumb_"+a),!i.length&&s.length?e.prepend('<img class="etalage_thumb_image" src="'+s.attr("src")+'" />'):i.length||s.length||e.remove(),o.length&&e.find(".etalage_thumb_image").data("anchor",o.attr("href"))});var W=R.find(".etalage_thumb_image").css({width:e.thumb_image_width,height:e.thumb_image_height}).show();t.each(W,function(){t(this).data("src",this.src)});var M=t('<li class="etalage_magnifier"><div><img /></div></li>').appendTo(a),x=M.children("div"),j=x.children("img"),B=t('<li class="etalage_icon">&nbsp;</li>').appendTo(a);e.show_icon&&B.show();var A;e.show_hint&&(A=t('<li class="etalage_hint">&nbsp;</li>').appendTo(a).show());var H,O=e.zoom_element;"auto"!==O&&O&&t(O).length?H=t(O).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(O="auto",H=t('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(a));var Q,X=H.children("div");v&&(Q=t('<img class="etalage_zoom_preview" />').css({width:e.source_image_width,height:e.source_image_height,opacity:.3}).prependTo(X).show());var Y,D=X.children(".etalage_zoom_img").css({width:e.source_image_width,height:e.source_image_height});e.show_descriptions&&(Y=t('<div class="etalage_description'+(e.right_to_left?" rtl":"")+'"></div>').prependTo(H));var E,F,G,J,K,N=e.small_thumbs;(q>1||!e.smallthumb_hide_single)&&(E=t('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(a),F=E.children("ul"),t.each(W,function(){var a=t(this);o=a.data("src"),l=a.parents(".etalage_thumb").data("id"),t('<li><img class="etalage_small_thumb" src="'+o+'" /></li>').data("thumb_id",l).appendTo(F)}),G=F.children("li").css({opacity:e.smallthumb_inactive_opacity}),N<3&&(N=3),q>N?(o=W.eq(q-1).data("src"),l=R.eq(q-1).data("id"),t('<li class="etalage_smallthumb_first"><img class="etalage_small_thumb" src="'+o+'" /></li>').data("src",o).data("thumb_id",l).prependTo(F).css({opacity:e.smallthumb_inactive_opacity}),o=W.eq(0).data("src"),l=R.eq(0).data("id"),t('<li><img class="etalage_small_thumb" src="'+o+'" /></li>').data("src",o).data("thumb_id",l).appendTo(F).css({opacity:e.smallthumb_inactive_opacity}),G=F.children("li"),G.eq(N-1).addClass("etalage_smallthumb_last"),G.eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):G.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),t.each(G,function(a){t(this).data("id",a+1)}),J=G.children("img"),K=G.length,"vert"===z&&G.addClass("vertical")),n=e.magnifier_invert?1:e.magnifier_opacity;var P=parseInt(R.css("borderLeftWidth"),10)+parseInt(R.css("borderRightWidth"),10)+parseInt(W.css("borderLeftWidth"),10)+parseInt(W.css("borderRightWidth"),10),S=parseInt(R.css("marginLeft"),10)+parseInt(R.css("marginRight"),10),U=parseInt(R.css("paddingLeft"),10)+parseInt(R.css("paddingRight"),10)+parseInt(W.css("marginLeft"),10)+parseInt(W.css("marginRight"),10)+parseInt(W.css("paddingLeft"),10)+parseInt(W.css("paddingRight"),10),V=e.thumb_image_width+P+S+U,Z=e.thumb_image_height+P+S+U,$=0,tt=0,at=0,et=0,it=0,st=0,ot=0;(q>1||!e.smallthumb_hide_single)&&($=parseInt(G.css("borderLeftWidth"),10)+parseInt(G.css("borderRightWidth"),10)+parseInt(J.css("borderLeftWidth"),10)+parseInt(J.css("borderRightWidth"),10),tt=parseInt(G.css("marginTop"),10),at=parseInt(G.css("paddingLeft"),10)+parseInt(G.css("paddingRight"),10)+parseInt(J.css("marginLeft"),10)+parseInt(J.css("marginRight"),10)+parseInt(J.css("paddingLeft"),10)+parseInt(J.css("paddingRight"),10),"vert"===z?(it=Math.round((Z-(N-1)*tt)/N)-($+at),et=Math.round(e.thumb_image_width*it/e.thumb_image_height),st=et+$+at,ot=it+$+at):(et=Math.round((V-(N-1)*tt)/N)-($+at),it=Math.round(e.thumb_image_height*et/e.thumb_image_width),st=et+$+at,ot=it+$+at));var lt,nt,rt=parseInt(H.css("borderTopWidth"),10),ht=parseInt(e.zoom_area_distance),ct=parseInt(H.css("paddingTop"),10);lt=e.zoom_area_width-2*rt-2*ct>e.source_image_width?e.source_image_width:e.zoom_area_width-2*rt-2*ct,nt="justify"===e.zoom_area_height?Z+tt+ot-2*rt-2*ct:e.zoom_area_height-2*rt-2*ct,nt>e.source_image_height&&(nt=e.source_image_height);var _t,mt,dt,gt;e.show_descriptions&&(_t=parseInt(Y.css("borderLeftWidth"),10)+parseInt(Y.css("borderRightWidth"),10),mt=parseInt(Y.css("marginLeft"),10)+parseInt(Y.css("marginRight"),10),dt=parseInt(Y.css("paddingLeft"),10)+parseInt(Y.css("paddingRight"),10),gt=lt-_t-mt-dt);var ut;b&&(ut=t('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(H));var pt=parseInt(M.css("borderTopWidth"),10),ft=parseInt(R.css("borderTopWidth"),10)+parseInt(R.css("marginTop"),10)+parseInt(R.css("paddingTop"),10)+parseInt(W.css("borderTopWidth"),10)+parseInt(W.css("marginTop"),10)-pt,bt=W.offset().left-a.offset().left-pt;"left"===e.smallthumbs_position&&(bt=bt+st+tt);var vt,wt,yt=Math.round(lt*(e.thumb_image_width/e.source_image_width)),It=Math.round(nt*(e.thumb_image_height/e.source_image_height)),kt=ft+e.thumb_image_height-It,Ct=bt+e.thumb_image_width-yt,Tt=Math.round(yt/2),zt=Math.round(It/2);if(e.show_hint&&(vt=parseInt(e.hint_offset,10)+parseInt(A.css("marginTop"),10),wt=parseInt(e.hint_offset,10)+parseInt(A.css("marginRight"),10),"right"===e.smallthumbs_position&&(wt=wt-st-tt)),"vert"===z?(c=V+tt+st,a.css({width:c,height:Z})):(c=V,a.css({width:c,height:Z+tt+ot})),e.show_icon&&(m={top:Z-B.outerHeight(!0)-parseInt(e.icon_offset,10),left:parseInt(e.icon_offset,10)},"left"===e.smallthumbs_position&&(m.left=st+tt+parseInt(e.icon_offset,10)),B.css(m)),e.show_hint&&A.css({margin:0,top:-vt,right:-wt}),j.css({margin:0,padding:0,width:e.thumb_image_width,height:e.thumb_image_height}),x.css({margin:0,padding:0,width:yt,height:It}),M.css({margin:0,padding:0,left:(Ct-bt)/2,top:(kt-ft)/2}).hide(),"left"===e.smallthumbs_position&&M.css({left:(Ct-bt)/2+st+tt}),X.css({width:lt,height:nt}),"right"===e.align&&"auto"===O?H.css({left:-(lt+2*rt+2*ct+ht)}):"auto"===O&&H.css({left:c+ht}),H.css({margin:0}).css({opacity:0}).hide(),e.show_descriptions&&(m={width:gt,bottom:ct,left:ct,opacity:e.description_opacity},"top"===e.description_location&&(m.top=ct,m.bottom="auto"),Y.css(m).hide()),q>1||!e.smallthumb_hide_single)if("vert"===z?("left"===e.smallthumbs_position?R.css({left:st+tt}):E.css({left:V+tt}),E.css({top:0,height:Z}),F.css({height:ot*K+K*tt}),J.css({width:et,height:it}).attr("height",it),G.css({margin:0,marginBottom:tt})):(E.css({top:Z+tt,width:V}),F.css({width:st*K+K*tt}),J.css({width:et,height:it}).attr("width",et),G.css({margin:0,marginRight:tt})),_="vert"===z?ot*N+(N-1)*tt-Z:st*N+(N-1)*tt-V,_>0)for(i=1;i<=K-1;i+=N-1)for(s=1;s<=_;s+=1)"vert"===z?G.eq(i+s-1).css({marginBottom:tt-1}):G.eq(i+s-1).css({marginRight:tt-1});else if(_<0)for(i=1;i<=K-1;i+=N-1)for(s=1;s<=-_;s+=1)"vert"===z?(G.eq(i+s-1).css({marginBottom:tt+1}),F.css({height:parseInt(F.css("height"),10)+1})):(G.eq(i+s-1).css({marginRight:tt+1}),F.css({width:parseInt(F.css("width"),10)+1}));e.show_icon&&!e.magnifier_invert&&M.css({background:M.css("background-color")+" "+B.css("background-image")+" center no-repeat"}),e.hide_cursor&&M.add(B).css({cursor:"none"}),b&&ut.css({width:X.css("width"),height:X.css("height")});var Rt=R.first().find(".etalage_thumb_image"),qt=R.first().find(".etalage_source_image");e.magnifier_invert&&j.attr("src",Rt.data("src")).show(),v&&Q.attr("src",Rt.data("src")),D.attr("src",qt.attr("src")),e.show_descriptions&&(h=qt.attr("title"),h&&Y.html(h).show());var Lt=function(){r&&(clearInterval(r),r=!1)},Wt=function(){r&&Lt(),r=setInterval(function(){Ot()},e.autoplay_interval)},Mt=function(){M.stop().fadeTo(g,n),B.stop().animate({opacity:0},g),H.stop().show().animate({opacity:1},g),e.magnifier_invert&&Rt.stop().animate({opacity:e.magnifier_opacity},g),L&&Lt()},xt=function(){M.stop().fadeOut(e.speed),B.stop().animate({opacity:1},e.speed),H.stop().animate({opacity:0},e.speed,function(){t(this).hide()}),e.magnifier_invert&&Rt.stop().animate({opacity:1},e.speed,function(){e.click_to_zoom&&(w=!1)}),clearTimeout(y),L&&Wt()},jt=function(i,s){var o,l,n=a.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");i.addClass("etalage_smallthumb_active"),M.stop().hide(),H.stop().hide(),s||(p=!0,n.stop(!0,!0).animate({opacity:e.smallthumb_inactive_opacity},g),i.stop(!0,!0).animate({opacity:1},g,function(){p=!1})),a.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},e.speed,function(){t(this).hide()}),o=R.filter(".thumb_"+i.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},e.speed),Rt=o.find(".etalage_thumb_image"),qt=o.find(".etalage_source_image"),e.magnifier_invert&&j.attr("src",Rt.data("src")),v&&Q.attr("src",Rt.data("src")),D.attr("src",qt.attr("src")),e.show_descriptions&&(h=qt.attr("title"),h?Y.html(h).show():Y.hide()),L&&(Lt(),Wt()),l=i.data("id"),q>=N&&l--,Yt(l)},Bt=function(a,i,s,o){t.each(G,function(){var i=t(this),s={opacity:e.smallthumb_inactive_opacity};i.data("id")===o.data("id")&&(s.opacity=1),"vert"===z?s.top="-="+a:s.left="-="+a,i.animate(s,g,"swing",function(){p&&(o.addClass("etalage_smallthumb_active"),p=!1)})}),jt(o,!0)},At=function(){var t=C-I,a=T-k,e=-t/u,i=-a/u;I-=e,k-=i,t<1&&t>-1&&(I=C),a<1&&a>-1&&(k=T),D.css({left:I,top:k}),v&&Q.css({left:I,top:k}),(t>1||a>1||t<1||a<1)&&(y=setTimeout(function(){At()},25))},Ht=function(){var t;e.magnifier_invert&&a.find(".etalage_thumb_active").mouseleave(),e.right_to_left?(t=a.find(".etalage_smallthumb_active").next(),t.length||(t=G.first())):(t=a.find(".etalage_smallthumb_active").prev(),t.length||(t=G.last())),t.click()},Ot=function(){var t;e.magnifier_invert&&a.find(".etalage_thumb_active").mouseleave(),e.right_to_left?(t=a.find(".etalage_smallthumb_active").prev(),t.length||(t=G.last())):(t=a.find(".etalage_smallthumb_active").next(),t.length||(t=G.first())),t.click()},Qt=function(t){q<=N&&(t-=1);var e=G.eq(t);if(e.length&&!p){var i,s=a.find(".etalage_smallthumb_active"),o=s.data("id")-1;if(o>t){f=o-t;var l=a.find(".etalage_smallthumb_first"),n=l.data("id");t<n?(i=o-n,f-=i,l.click()):jt(e,!1)}else if(o<t){f=t-o;var r=a.find(".etalage_smallthumb_last"),h=r.data("id")-1;t>=h?(i=h-o-1,f-=i,r.click()):jt(e,!1)}f=!1}};window[d+"_previous"]=function(){Ht()},window[d+"_next"]=function(){Ot()},window[d+"_show"]=function(t){Qt(t)};var Xt=function(t){return!!e.click_callback(t,d)&&("function"!=typeof etalage_click_callback||(etalage_click_callback(t,d),!1))},Yt=function(t){e.change_callback(t,d)&&"function"==typeof etalage_change_callback&&etalage_change_callback(t,d)};R.add(M).add(B).mouseenter(function(){e.show_hint&&A.hide(),e.click_to_zoom&&!w||Mt()}).mouseleave(function(){xt()});var Dt=-(e.source_image_width-lt),Et=-(e.source_image_height-nt);R.add(M).add(B).mousemove(function(t){var a=Math.round(t.pageX-Rt.offset().left+bt),i=Math.round(t.pageY-Rt.offset().top+ft),s=a-Tt,o=i-zt;if(s<bt&&(s=bt),s>Ct&&(s=Ct),o<ft&&(o=ft),o>kt&&(o=kt),M.css({left:s,top:o}),e.magnifier_invert){var l=s-bt,n=o-ft;j.css({left:-l,top:-n})}C=-((s-bt)*(1/(e.thumb_image_width/e.source_image_width))),T=-((o-ft)*(1/(e.thumb_image_height/e.source_image_height))),C<Dt&&(C=Dt),T<Et&&(T=Et),e.zoom_easing?(clearTimeout(y),At()):(v&&Q.css({left:C,top:T}),D.css({left:C,top:T}))}),(q>1||!e.smallthumb_hide_single)&&(a.delegate(".etalage_smallthumb_first","click",function(){if(!p||f){var e,i,s,o,l,n=t(this),r=1,h=0;f&&(r=f),p=!0;for(var c=0;c<r;c+=1)e=n.removeClass("etalage_smallthumb_first"),i=a.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last"),n.prev().length?(s=e.prev().addClass("etalage_smallthumb_first"),o=i.prev().addClass("etalage_smallthumb_last"),l=e):(s=G.eq(K-N).addClass("etalage_smallthumb_first"),o=G.eq(K-1).addClass("etalage_smallthumb_last"),l=o.prev()),h="vert"===z?s.position().top:s.position().left,n.prev().length&&(n=n.prev());Bt(h,s,o,l)}}),a.delegate(".etalage_smallthumb_last","click",function(){if(!p||f){var e,i,s,o,l,n=t(this),r=1,h=0;f&&(r=f),p=!0;for(var c=0;c<r;c+=1)e=a.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),i=n.removeClass("etalage_smallthumb_last"),n.next().length?(s=e.next().addClass("etalage_smallthumb_first"),o=i.next().addClass("etalage_smallthumb_last"),l=i):(s=G.eq(0).addClass("etalage_smallthumb_first"),o=G.eq(N-1).addClass("etalage_smallthumb_last"),l=s.next()),h="vert"===z?s.position().top:s.position().left,n.next().length&&(n=n.next());Bt(h,s,o,l)}}),G.click(function(){var a=t(this);a.hasClass("etalage_smallthumb_first")||a.hasClass("etalage_smallthumb_last")||a.hasClass("etalage_smallthumb_active")||p||jt(a,!1)}),e.smallthumb_select_on_hover&&G.mouseenter(function(){t(this).click()})),e.click_to_zoom?R.click(function(){w=!0,Mt()}):M.click(function(){var t=Rt.data("anchor");t&&Xt(t)&&(window.location=t)}),q>1&&e.keyboard&&t(document).keydown(function(t){39!==t.keyCode&&"39"!==t.keyCode||(e.right_to_left?Ht():Ot()),37!==t.keyCode&&"37"!==t.keyCode||(e.right_to_left?Ot():Ht())}),t(window).bind("load",function(){R.css({"background-image":"none"}),H.css({"background-image":"none"}),v&&(v=!1,Q.remove())}),L&&Wt()}}),this}}(jQuery);